var _audC=new(window.AudioContext||window.webkitAudioContext),_aud_MV=1;function tone(n,e){if(!_audC||!_aud_MV)return{f:function(){return this},v:function(){return this}};var t=_audC.currentTime,l=_audC.createOscillator(),a=_audC.createGain();return e&&(l.type=e),l.frequency.value=0,a.gain.value=0,l.connect(a),a.connect(_audC.destination),l.start(0),l.stop(t+n),{f:function(){if(1==arguments.length)return l.frequency.value=arguments[0],this;for(var e=0;e<arguments.length;e+=1)l.frequency.linearRampToValueAtTime(arguments[e],t+e/(arguments.length-1)*n);return this},v:function(){if(1==arguments.length)return a.gain.value=arguments[0]*_aud_MV,this;for(var e=0;e<arguments.length;e+=1)a.gain.linearRampToValueAtTime(arguments[e]*_aud_MV,t+e/(arguments.length-1)*n);return this}}}var ae={clk:()=>{tone(.2,"triangle").f(200,220,200).v(.1,.3,0),tone(.2,"triangle").f(220,200,220).v(.3,.1,0)},slide:()=>{tone(1).f(100,440).v(.1,.3,.1,.3,.1,.5,.6,0)},death:()=>{tone(2).f(100,300,100,300).v(.3,.5,.1,0),tone(2).f(200,100,200,100).v(.1,.2,.5,0)},weird:()=>{tone(3).f(120,420).v(0,.3),tone(3).f(220,420).v(0,.3),tone(3).f(320,420).v(0,.3)}};function m_bd(e){return{setB:e=>{ge("gban").textContent=e},update:()=>{ge("gamebrd").textContent="Turn "+e.tn},selMove:async()=>new Promise((e,n)=>{ge_gone("play",!1),geclk("play",()=>{ge_gone("play",!0),e(1)})})}}async function selTurn(e,n,t,l){switch(t.t){case"l":return n.setB("Your turn to play, "+t.n),n.selMove();case"r":return n.setB("Waiting for "+t.n+" to play..."),new Promise((n,e)=>{lobby.waitMsg(e=>n(e.move))});case"a":return 0}}async function pubTurn(e,n,t,l){"r"==t.t&&lobby.msg({move:l})}async function startGame(e,n){ge_gone("lobby",!0),ge_gone("game",!1);let t=m_gs(e,n),l=m_bd(t);l.setB("Starting Game...");for(;await(async()=>{var e=t.tn%2;l.update(),l.setB(t.p[e].n+"'s turn");var n=await selTurn(t,l,t.p[e],e);return await pubTurn(t,e?0:1,t.p[e?0:1],n),t.move(n),l.update(),!(5<t.tn)||(l.setB("game over"),await wait(2e3),!1)})(););lobby.reset()}function m_gs(e,n){return{tn:0,p:[{...e},{...n}],move:function(e){this.tn+=1}}}mkL=(e,n,t,a,o,r)=>{var i=[0,1,2,3];xl=null==e?i:[e],yl=null==n?i:[n],zl=null==t?i:[t];var u=[];return xl.forEach(l=>yl.forEach(t=>zl.forEach(n=>{u.push(i.map(e=>l+a*e+4*(t+o*e)+16*(n+r*e)))}))),u};var allLines=[...mkL(0,null,null,1,0,0),...mkL(null,0,null,0,1,0),...mkL(null,null,0,0,0,1),...mkL(0,0,null,1,1,0),...mkL(3,0,null,-1,1,0),...mkL(0,null,0,1,0,1),...mkL(3,null,0,-1,0,1),...mkL(null,0,0,0,1,1),...mkL(null,3,0,0,-1,1),...mkL(0,0,0,1,1,1),...mkL(3,0,0,-1,1,1),...mkL(3,3,0,-1,-1,1),...mkL(0,3,0,1,-1,1)];function _init_lobby(){let e=null,t=null;let l=null;try{l=io({upgrade:!1,transports:["websocket"]}),l.on("connect",()=>{}),l.on("lobby",e=>{let n=e.available.filter(e=>e.nick!=ge("nick").value).map(e=>({t:"Play with "+e.nick,lt:"Play online with this player",u:e,em:"ðŸ”—"}));n.length||(n=[{t:"No opponent",lt:"There are no others players in the lobby right now.",em:"ðŸ˜ž"}]),menu("Player vs Player Online: Select Opponent",!0,n,(e,n)=>{l.emit("reqstart",{opponent:e.u.id})})}),l.on("disconnect",()=>{}),l.on("gm",e=>{let n=t;t=null,n&&n(e)}),l.on("playstart",e=>{var n={n:e.op,t:"r"},t={n:ge("nick").value,t:"l"};e.lead?startGame(t,n):startGame(n,t)}),l.on("playend",()=>{gamedone()}),l.on("error",()=>{})}catch(e){}geclk("bck",()=>{ae.clk(),leave_mp(),reset()}),menu=(e,n,t,l)=>{ge("menu").innerHTML="",ge_qs("bot","legend").textContent=e,t.forEach((e,n)=>{let t=clone("menu","menui");qs_txt(t,"h1",e.em),qs_txt(t,"h2",e.t),qs_txt(t,"h3",e.lt),t.onclick=()=>{ae.clk(),l(e,n)}}),ge_gone("bck",!n)},display=(e,n)=>{ge("menu").innerHTML="",ge_qs("bot","legend").textContent=e;e=clone("menu","displayi");qs_txt(e,"pre",n),ge_gone("bck",!1)};let a=()=>{l.emit("el",{nick:ge("nick").value}),ge_no("top",!0)};return leave_mp=()=>{l.emit("ll",{}),ge_no("top",!1),reset()},gamedone=()=>{e&&l.emit("reqend"),document.body.classList.toggle("ms",!0)},reset=()=>{ge_gone("lobby",!1),ge_gone("game",!0),menu("Select Game Type",!1,m_main,(e,n)=>{switch(n){case 0:display("Instructions","Instructions go here");break;case 1:menu("Player vs Computer: Opponent",!0,m_ais,(e,n)=>{p1={n:ge("nick").value,t:"l"},p2={n:e.t,t:"a",pp:e.pp},startGame(p1,p2)});break;case 2:p1={n:ge("nick").value,t:"l"},p2={n:"Player 2",t:"l"},startGame(p1,p2);break;case 3:a()}})},{waitMsg:e=>{t=e},msg:e=>{l.emit("gm",e)},menu:menu,enter_mp:a,reset:reset,gamedone:gamedone}}console.log("allLines:",allLines);var lobby=null;function start_lobby(){lobby=lobby||_init_lobby(),ge("nick").value=oneof(["Fried","Crazy","Wise","Smart","Clever"])+" "+oneof(["Alex","Storm","Petra","Zena"])+" "+ +new Date%100,lobby.reset()}function init(){start_lobby()}let m_main=[{t:"How to Play",em:"ðŸŽ“",lt:"Learn the simple rules"},{t:"Play vs Computer",em:"ðŸ’»",lt:"Play against various AI opponents"},{t:"Player vs Local Player",em:"ðŸŽŽ",lt:"Play against a friend on one device"},{t:"Player vs Online Player",em:"ðŸ”—",lt:"Play against a human online"}],m_ais=[{t:"Easy Opponent",em:"ðŸ’»",lt:"Not very good, does it's best to score.",pp:{s:4,o:1,p:0,r:5,d:0}},{t:"Novice",em:"ðŸ’»",lt:"A novice player, good to learn against.",pp:{s:5,o:2,p:1,r:5,d:1}}],ge=e=>document.getElementById(e),gecl=(e,n,t)=>ge(e).classList.toggle(n,t),geclk=(e,n)=>ge(e).onclick=n,ge_gone=(e,n)=>gecl(e,"gone",n),ge_no=(e,n)=>gecl(e,"no",n),cloneIn=(e,n,t)=>{t=document.querySelector("#"+n).content.querySelector(t).cloneNode(!0);return e.appendChild(t),t},clone=(e,n)=>cloneIn(ge(e),n,"*"),ge_qs=(e,n)=>ge(e).querySelector(n),qs_txt=(e,n,t)=>e.querySelector(n).textContent=t,oneof=e=>Array.isArray(e)?e[Math.floor(Math.random()*e.length)]:e,wait=n=>new Promise(e=>setTimeout(e,n));